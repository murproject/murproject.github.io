Title: Настройка роутера для HighROV
Slug: highrov-router

В наборе HighROV имеется роутер, который раздаёт WiFi-сеть. Также через кабель к нему подключается основная плата.

## 1. Быстрая настройка

На роутере задаём переключатель в положение __AP__.

Подключаем роутер к компьютеру через Ethernet-кабель. Заходим в панель по IP: `192.168.1.1`. При первом включении роутера будет предложена быстрая настройка сети. Задаём параметры:

- Mode: `Access Point` (точка доступа)
- SSID: `HighROV` (название сети),
- Password: `robocenter` (пароль сети),
- Admin password: `robocenter` (пароль админки роутера).

Если быстрая настройка не была предложена, то эти параметры нужно указать в разделе `Wireless`.

## 2. DHCP

WiFi будет раздаваться, но для корректной работы аппарата с RovUI нужно также настроить параметры IP-адресов. Дело в том, что аппарату соответствует определенный IP, и телеметрия с управлением также привязаны к определённому адресу. Нужно всё настроить таким образом, чтобы компьютер получал адрес `192.168.1.4`, в то время как аппарат должен быть привязан к адресу `192.168.1.5`.

В панели управления роутера заходим в `Network / LAN Settings`.

На скриншоте показаны эталонные настройки, отдельно выделено то, что требует особого внимания:

![screenshot](/media/highrov-router/wifi1.png)

- `IP Address: 192.168.1.1` - адрес роутера,
- `DHCP: ON; DHCP Server` - включить автоматическое распределение IP-адресов,
- `IP Address Pool: 192.168.1.4 - 192.168.1.10` - диапазон адресов, в пределах которого будут присваиваться IP-адреса. Первым будет присвоен 192.168.1.4, что соответствует компьютеру пользователя. Аппарату будет присвоен другой адрес, т.к. далее сделаем привязку по MAC,
- `Default Gateway: 192.168.1.1` - шлюз (у нас это сам роутер).

Далее нужно обеспечить привязку MAC-адреса аппарата к нужному IP-адресу. В секции Address Reservation доабвляем новое правило:

![screenshot](/media/highrov-router/wifi2.png)

Устанавливаем настройки правила:

![screenshot](/media/highrov-router/wifi3.png)

- `MAC Address: DEADBEEFFEED` - физический адрес основной платы аппарата (прописан в прошивке и одинаков для всех плат, если не менять прошивку),
- `IP: 192.168.1.5` - соответствующий IP-адрес,
- `Enable This Entry: ON` - не забываем включить правило.

## 3. (Дополнительно) Задать IP для WiFi-модуля

Если прошивка HighROV предусматривает возможность перепрошивки по WiFi, то понадобится в роутере присвоить IP-адрес для WiFi-модуля ардуинки. Иначе, при подключении к WiFi он может получить не тот адрес.

Добавляем новое правило Address Reservation, и нажимаем кнопку `Scan`. Если ардуинка подключена по WiFi, то будет видно устройство `arduino-…`. Его нужно добавить и присвоить IP-адрес `192.168.1.6`

![screenshot](/media/highrov-router/wifi4.png)

Если всё сделано правильно, то схема получается такой:

- `192.168.1.4` - Компьютер/ноутбук пользователя
- `192.168.1.5` - Ethernet-модуль Arduino Nano 33 IoT (для телеметрии и управления)
- `192.168.1.6` - WiFi-модуль Arduino Nano 33 IoT (для обновления прошивки по WiFi)

![screenshot](/media/highrov-router/wifi5.png)

## Итоги

Перед проверкой надо подключить плату HighROV к роутеру с помощью кабеля.

Для проверки правильности работы следует проверить присваеваемый компьютеру IP-адрес, а также попинговать адрес платы `192.168.1.5`; а вообще неплохо будет запустить RovUI и попытаться посмотреть телеметрию, которую отправляет плата. Если вместо прочерков (`Крен: -`) указаны нули или другие значения (`Крен: 0`), то значит, что телеметрия идёт. Также можно нажать на кнопку `Начать запись`, если подключение есть, то счётчик записей будет увеличиваться.
